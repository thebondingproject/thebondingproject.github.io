<!DOCTYPE HTML>

<head>
	<title>The Bonding Project</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	<link rel="stylesheet" href="assets/css/main.css" />
</head>

<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Main -->
		<div id="main">
			<div class="inner">

				<!-- Header -->
				<script src="header.js"></script>

				<!-- Content -->
				<section>
					<header class="main">
						<h1>Future work: LCD and external RAM</h1>
					</header>

					<h2>Introduction</h2>
					<h4>Rationale</h4>
					<p>
						As we wanted to build a completely standalone bonding machine we couldn't rely on a computer screen
						and keyboard to control the bonding process. We decided that an interactive touchscreen LCD
						alongh with a physical joystick would make a great UI for our machine.
						<br>
						The idea is to control the movement of the machine through the joystick while the screen is used
						to configure parameters, input data, view the camera, etc.
					</p>

					<h4>The problem of memory</h4>
					<p>
						The LCD we decided to use is a 800x480 RGB LCD TFT screen which requires a framebuffer of at most 800*480*3=1152000 bytes
						depending on the color space used.
						This exceeds the maxiumum RAM available on our STM32H723ZGT6 microcontroller, meaning that we need to use an external
						RAM to store and elaborate the framebuffer.
						<br><br>
						This opens up a question: which of the many RAM technology is best for us? 
					</p>

					<hr class="major" />

					<h2>RAM</h2>
					<h4>The problem with SDRAMs</h4>
					<p>
						We could use a standard parallel SRAM which is widely supported and diffused on all microcontrollers, but it
						requires a lot of interconnections and microcontroller pins.
						Pins are shared by various hardware interfaces; reserving them for she SRAM means that many of these interfaces
						will become impossible to use. Furthermore, having lots of interconnections means that the PCB design gets more
						complex and manufacturing more expensive as more PCB layers might be required.
						<br><br>
						The problem of interconnections became really evident when we tried to connect a 50 pin SMD M12L16161A SDRAM to a
						NUCLEO-H723ZG as it can be seen in the photo below. You can find the datasheet in the <a href="downloads.html#lcd_ram">downloads</a>
						section of this website.
						<div class="box alt">
							<div class="row aln-center">
								<div class="col-6"><span class="image fit"><img
											src="media/lcd_ram/M12L16161A.jpg" alt="" /></span></div>
								<div class="col-6"><span class="image fit"><img
											src="media/pic01.jpg" alt="" /></span></div>
							</div>
						</div>
						<br>
						We then configured the microcontroller to interface the external RAM and everything worked almost out of the box.
						Unfortunately we soon encountered a problem we couldn't get around in any way: one of the pins used by the SDRAM
						is shared with the parallel camera interface and we need to use both of them.
						<br><br>
						This problem forced us to abandon the SDRAM strategy. We could've tried unhortodox ways to get around it by
						bypassing the ST IOC configurator and manually remapping pins using confiuguration text files,
						but we decided against it as we didn't want to give up the comfort of the IOC graphical interface. As a matter of fact,
						the IOC doesn't just configurate interfaces, but also generates code automatically which helps to save loads of time
						during development. 
					</p>
					<h4>Using HyperRAMs</h4>
					<p>
						The other strategy is to use HyperRAMs, which use a serial protocol to communicate to and from the microcontroller
						requiring less pins to be utilized. Unfortunately HyperRAMs are a new technology, meaning that documentation and examples
						are scarce.
						<br><br>
						We chose a IS66WVH8M8FALL ISSI 64Mb (megabits, i.e. 8 megabytes) HyperRAM. You can find the datasheet in the
						<a href="downloads.html#lcd_ram">downloads</a> section of this website. As you can immediately see in the photos below,
						the HyperRAM's connections are way simpler and tidier.
						<div class="box alt">
							<div class="row aln-center">
								<div class="col-6"><span class="image fit"><img
											src="media/lcd_ram/hypperram_scheme.jpg" alt="" /></span></div>
								<div class="col-6"><span class="image fit"><img
											src="media/placeholder" alt="" /></span></div>
							</div>
						</div>

						The problem with this solution is that we haven't yet been able to make it work yet, at least not to an usable degree.
						We can read configuration registers but we can't access the RAM contents reliably from the Nucleo board.
						This is most likely because the HyperRAM operates at MHz frequency, and interconnections require matching and proper
						routing. We won't be able to test it properly until we make the final PCB for the MCU, where connections
						will be designed correctly to avoid reflections and differences in flight times.
					</p>
					
					<hr class="major" />

					<h2>The screen</h2>
					<h4>Hardware description</h4>
					<p>
						We opted for an Ampire AM-800480E4TMQW-02H LCD TFT screen module that one member bought at an electronics fair
						a few years back. The datasheet is available in the <a href="downloads.html#lcd_ram">downloads</a> section.
						<br><br>
						We interface the LCD screen with the RGB565 protocol, meaning that each pixel requires 16 bits to be driven
						(5 for red, 6 for green, 5 for blue). Therefore, each frame requires 800*480*2=768000 bytes. As already
						stated in the introduction of this page, this value exceeds the maximum RAM available on our microcontroller
						forcing us to use an external RAM.

						<div class="box alt">
							<div class="row aln-center">
								<div class="col-6"><span class="image fit"><img
											src="media/lcd_ram/screen_architecture.jpg" alt="" /></span></div>
								<div class="col-6"><span class="image fit"><img
											src="media/placeholder" alt="" /></span></div>
							</div>
						</div>
					</p>
					<h4>Custom enclosure and mounting point</h4>
					<p>
						foto dell'enclosure e mostrare com'è montato sulla macchina
					</p>

					<hr class="major" />
					
					<h2>The GUI</h2>
					<h4>Using the STM32 TouchGFX library</h4>
					<p>
						Descrivere perché e percome abbiamo scelto TouchGFX
					</p>
					<h4>Image gallery</h4>
					<p>
						Far vedere l'interfaccia progettata finora
					</p>	
				</section>
			</div>
		</div>

		<!-- Sidebar and Footer -->
		<script src="sidebar_and_footer.js"></script>
	</div>

	<!-- Scripts -->
	<script src="js_scripts.js"></script>
</body>

</html>