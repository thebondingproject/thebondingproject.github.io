<!DOCTYPE HTML>

<head>

	<title>The Bonding Project</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	<link rel="stylesheet" href="assets/css/main.css" />
</head>

<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Main -->
		<div id="main">
			<div class="inner">

				<!-- Header -->
				<script src="header.js"></script>

				<!-- Content -->
				<section>
					<header class="main">
						<h1>Motor control</h1>
					</header>

					<h2>Introduction</h2>
					<h4>Rationale</h4>
					<p>
					The bonding machine needs to control 4 independent axes (X, Y, Z and θ ) with 4 motors as already described in the
					<a href="mechanical_description.html">mechanical description</a>.
					<br>
					Furthermore, we decided to keep the master control unit (MCU) separate from the motor drivers.
					Each driver is a slave board communicates with the MCU through a custom serial protocol
					(see <a href="system_architecture.html">system architecture</a>), and each motor is controlled by a separate board.
					</p>

					<h4>From demo boards to a custom PCB</h4>
					<p>
					The heart of the driver is a STM32F302R876 microcontroller by ST Microelectronics which controls a BD16912EFV-C
					motor driver IC by ROHM Semiconductor. Each manufacturer offers demo board we could buy and use for our project,
					but we decided to design our own custom PCB to host the two ICs for the following reason:
					<ul>
						<li>The STM Nucleo demo boards are expensive; the same goes for the BD16912EFV-C demo boards. It was cheaper
							to buy the individual components and assemble them on a custom PCB, as PCB manufacturing in China is very
							cheap nowadays (5 small boards cost €5). Shipping is actually more expensive than manufacturing, as fast shipping
							with a courier costs €20;</li>
						<li>Demo boards are bulky and have a lot of unnecessary headers and components; our boards contain the bare
							minimum to make the circuit work reliably, reducing the physical size of the drivers. This is important
							because we want to house all electronics in a small box mounted on the the bonding machine itself;</li>
						<li>Building custom PCBs is an important skill that cannot be taught in ordinary classroom lessons; we figured
							we could use this opportunity to consolidate our PCB design skills.</li>
					</ul>
					</p>
					
					<hr class="major" />
					
					<h2>Drivers boards in detail</h2>
					<p>
						The schematic, the PCB layout and the 3D model can be found in the
						<a href="downloads.html#motor_control">downloads area</a>
						of this website.
					</p>

					<h4>Schematic</h4>
					<span class="image fit"><img src="media/motor_driver/Servo_Motor_Driver_schematic.gif" alt="" /></span>

					<h4>Image gallery</h4>
					<p>
					<ul>
						<li><b>Top-left</b>: top view of the PCB;</li>
						<li><b>Top-right</b>: bottom view of the PCB;</li>
						<li><b>Bottom-left</b>: 3D view of the PCB;</li>
						<li><b>Bottom-right</b>: assembled PCB.</li>
					</ul>
					<div class="box alt">
						<div class="row aln-center">
							<div class="col-6"><span class="image fit"><img
										src="media/motor_driver/Servo_Motor_Driver_top.gif" alt="" /></span></div>
							<div class="col-6"><span class="image fit"><img
										src="media/motor_driver/Servo_Motor_Driver_bottom.gif" alt="" /></span></div>
							<div class="col-6"><span class="image fit"><img
										src="media/motor_driver/Servo_Motor_Driver_pcb.gif" alt="" /></span></div>
							<div class="col-6"><span class="image fit"><img
										src="media/motor_driver/assembled_PCB.jpeg" alt="" /></span></div>
						</div>
					</div>
					</p>
					
					<hr class="major" />
					<h2>PI controller</h2>
					<p>
						<span class="image fit"><img src="media/motor_driver/Servvo_block_diagram.PNG" alt="" /></span>
						
						<span class="image right"><img src="media/motor_driver/Motor_model.PNG" alt="" /></span>

						<span class="image fit"><img src="media/motor_driver/PI_controller.PNG" alt="" /></span>
					</p>

					<hr class="major" />
					
					<h2>Motion profiling</h2>
					<p>
						
						<span class="image right"><img src="media/motor_driver/trapezoidal_profiling.png" alt="" /></span>

						In order to achieve smooth movement on each of the four axes, we decided to implement trapezoidal motor profiling
						by following <a href="https://www.ctrlaltftc.com/advanced/motion-profiling">this article</a> (you can find a 
						PDF print of this article in the <a href="downloads.html#motor_control">downloads area</a>).
						<br><br>
						As you can see on the image on the right, by shaping the velocity target as the trapezoid (orange line), a smooth
						movement can be achieved (blue line): the motor first accelerates, cruises at a constant speed for a while,
						and then decelerates smoothly when the destination is almost reached.
						<br>
						The control algorithm for motion profiling operates in the following way:
						<ul>
							<li> Setup phase:
								<ul>
									<li>Obtain the start and finish positions;</li>
									<li>Set the maximum acceleration and cruising speed;</li>
									<li>Calculate the speed trapezoidal profile;</li>
								</ul>
							</li>
							<li> Movement phase (inside a while loop):
								<ul>
									<li>Calculate the setpoint position based on the trapezoidal speed profile;</li>
									<li>Command the PI controller to reach the target position;</li>
									<li>Repeat until the destination is reached.</li>
								</ul>
							</li>
						</ul>
						You can see in this video that the motor can accelerate and slow down in a controlled manner without jerks.
						TODO: metterci il video che avevo mandato su whatsapp sul gruppo
					</p>
				</section>
			</div>
		</div>

		<!-- Sidebar and Footer -->
		<script src="sidebar_and_footer.js"></script>
	</div>

	<!-- Scripts -->
	<script src="js_scripts.js"></script>
</body>

</html>